# Rumour Map - Implementation Plan

**Repository:** `surpdeh/rumour-map`  
**Created:** 2026-01-31  
**Status:** Planning

---

## Problem Statement

Build and deploy a Vue.js single-page application that displays a high-resolution map with interactive "rumour" markers. Rumours are loaded from a static PSV file and can be unpinned, dragged, and expanded to show details. The app should be deployed to GitHub Pages via GitHub Actions.

## Proposed Approach

1. **Feature Implementation**: Build the rumours feature following the specification
2. **GitHub Pages Setup**: Configure Vite for GitHub Pages deployment
3. **CI/CD Pipeline**: Create GitHub Actions workflow for automated deployment
4. **Testing & Validation**: Ensure functionality works in production environment

---

## Workplan

### Phase 1: Rumours Feature - Data Layer
- [ ] Create sample `public/rumours.psv` file with test data (5-10 rumours)
- [ ] Create `src/composables/useRumours.js` for PSV loading and parsing
- [ ] Add error handling for file loading failures
- [ ] Test PSV parsing with valid and malformed data

### Phase 2: Rumours Feature - Core Components
- [ ] Create `src/components/RumourMarker.vue` (basic display, no interactions yet)
- [ ] Create `src/components/RumourOverlay.vue` (container component)
- [ ] Integrate RumourOverlay into `PanZoomMap.vue`
- [ ] Implement coordinate transformation (map coords → screen coords)
- [ ] Test markers display at correct positions

### Phase 3: Rumours Feature - Interactions
- [ ] Implement hover state and description expansion in `RumourMarker.vue`
- [ ] Add pin/unpin toggle functionality
- [ ] Create `src/composables/useRumourDrag.js` for drag logic
- [ ] Implement drag-and-drop for unpinned rumours
- [ ] Add boundary constraints (keep rumours within map bounds)
- [ ] Test zoom/pan - verify rumours maintain relative positions

### Phase 4: Rumours Feature - Polish
- [ ] Add smooth transitions and animations
- [ ] Implement responsive sizing (mobile/tablet/desktop)
- [ ] Add loading state while PSV file loads
- [ ] Add empty state if no rumours found
- [ ] Style markers with Tailwind CSS (following Primer theme)
- [ ] Add touch gesture support (long-press to unpin on mobile)

### Phase 5: Accessibility
- [ ] Add keyboard navigation (Tab, Enter, Arrow keys, Escape)
- [ ] Add ARIA labels and roles to markers
- [ ] Test with screen reader (VoiceOver on macOS/iOS)
- [ ] Ensure focus indicators are visible
- [ ] Verify color contrast ratios (WCAG AA)

### Phase 6: GitHub Pages Configuration
- [ ] Update `vite.config.js` with base path for GitHub Pages
- [ ] Add `base: '/rumour-map/'` configuration
- [ ] Test build locally: `npm run build`
- [ ] Test preview locally: `npm run preview`
- [ ] Verify all assets load correctly with base path

### Phase 7: GitHub Actions Workflow
- [ ] Create `.github/workflows/` directory
- [ ] Create `deploy.yml` workflow file
- [ ] Configure workflow to:
  - Trigger on push to `main` branch
  - Install Node.js and dependencies
  - Run `npm run build`
  - Deploy as described in https://github.com/actions/deploy-pages
- [ ] Configure GitHub Pages settings in repository

### Phase 8: Testing & Validation
- [ ] Push workflow to GitHub
- [ ] Monitor first deployment run
- [ ] Fix any deployment issues
- [ ] Test deployed site on GitHub Pages
- [ ] Verify all features work in production:
  - Map pan and zoom
  - Rumours load from PSV
  - Drag and drop functionality
  - Mobile touch gestures
  - Responsive design
- [ ] Test on multiple browsers (Chrome, Firefox, Safari)
- [ ] Test on mobile devices

### Phase 9: Documentation
- [ ] Update README.md with:
  - Rumours feature documentation
  - PSV file format explanation
  - Deployment instructions
  - GitHub Pages URL
- [ ] Add screenshot/GIF of rumours feature
- [ ] Document how to add new rumours to PSV file

---

## Notes & Considerations

### Technology Stack
- **Framework:** Vue.js 3 (Composition API, `<script setup>`)
- **Build Tool:** Vite
- **Styling:** Tailwind CSS + GitHub Primer CSS
- **Deployment:** GitHub Pages via GitHub Actions
- **No additional libraries** unless absolutely necessary

### Key Technical Decisions

1. **Coordinate System**: Map coordinates (0-6500, 0-3600) transform to screen coordinates using scale/translate from PanZoomMap
2. **State Management**: Use reactive refs in composables (no Vuex/Pinia needed for this simple app)
3. **Styling**: Tailwind utility classes with custom components extending Primer CSS
4. **Performance**: CSS transforms for positioning (GPU-accelerated), throttle updates during pan/zoom

### GitHub Pages Deployment Strategy

**Approach:** Use `main` branch for deployment
- Main branch contains source code
- GitHub Action builds from `main` and runs deploy-pages action

**Vite Configuration:**
```js
base: '/rumour-map/' // Matches repository name
```

**GitHub Action:**
- Use `actions/checkout@v4`
- Use `actions/setup-node@v4`
- Use `https://github.com/actions/deploy-pages` for deployment

### PSV File Format Example
```
R1|1200|800|Dragon Sighting|Locals report seeing a large winged creature near the northern peaks.
R2|3400|1500|Abandoned Fort|Ancient fortifications found empty. Signs of recent occupation remain.
R3|2100|2200|Trade Route Closed|Merchant caravans report bandits. Authorities investigating.
```

### Responsive Breakpoints
- Mobile: < 768px (compact markers, tap interactions)
- Tablet: 768px - 1023px (medium markers, touch drag)
- Desktop: ≥ 1024px (full markers, hover + drag)

### Open Questions
1. Should rumour positions persist in localStorage after dragging?
   - **Decision:** Not in Phase 1 (future enhancement)
2. Should there be a limit on expanded rumours?
   - **Decision:** Allow multiple, bring hovered to front with z-index
3. Should the PSV file be editable in-app?
   - **Decision:** No, read-only for v1

---

## Success Criteria

✅ **Feature Complete** when:
- Rumours load from PSV file and display correctly
- Hover expansion works smoothly
- Pin/unpin and drag functionality works
- Keyboard navigation is fully functional
- Mobile touch gestures work

✅ **Deployment Complete** when:
- GitHub Actions workflow runs successfully
- Site is accessible at `https://surpdeh.github.io/rumour-map/`
- All features work in production environment
- No console errors

✅ **Quality Standards Met** when:
- Code follows constitution principles
- Accessibility meets WCAG AA standards
- Performance maintains 60fps during interactions
- Works on Chrome, Firefox, Safari (mobile + desktop)

---

## Risk Mitigation

### Potential Issues

1. **Coordinate Transform Complexity**
   - Risk: Rumours don't stay in correct positions during zoom/pan
   - Mitigation: Test extensively, use proven transform formula

2. **GitHub Pages Base Path**
   - Risk: Assets fail to load with incorrect path
   - Mitigation: Test build locally with preview before deploying

3. **Touch Gesture Conflicts**
   - Risk: Pan/zoom conflicts with rumour dragging
   - Mitigation: Stop event propagation on rumour interactions

4. **Performance with Many Rumours**
   - Risk: FPS drops with 50+ rumours
   - Mitigation: Implement viewport culling if needed (Phase 2 optimization)

---

## Timeline Estimate

- Phase 1-2 (Data + Core): 2-3 hours
- Phase 3-4 (Interactions + Polish): 2-3 hours
- Phase 5 (Accessibility): 1-2 hours
- Phase 6-7 (Deployment Setup): 1 hour
- Phase 8 (Testing): 1-2 hours
- Phase 9 (Documentation): 30 minutes

**Total:** ~8-12 hours of development

---

## Next Steps

**When ready to implement:**
1. Review this plan and make any necessary adjustments
2. Start with Phase 1: Create sample PSV file and data composable
3. Work through phases sequentially
4. Test thoroughly after each phase
5. Deploy when all features are complete and tested

**To begin implementation, say:** "start" or "get to work"
